@using ValuBakery.Web.Helpers;
@if (ProductDto == null)
{
    <MudPaper Height="400px" Style="margin:1%" Elevation="20">

    </MudPaper>
}
else
{
     <MudDialog Class="fixed-dialog" @key="dialogRenderKey">
        <TitleContent>
            <MudStack Row="true" AlignItems="AlignItems.Start" Spacing="4">
                <MudTooltip Text=@ProductDto?.Name>
                    <MudImage Src="images/no_image.png"
                          ObjectFit="ObjectFit.Fill"
                          Width="150" Height="150"
                          Alt=@ProductDto?.Name
                          Elevation="4"
                          Class="rounded-lg ma-2" />
                </MudTooltip>

                <MudStack Justify="Justify.SpaceBetween" AlignItems="AlignItems.Start" Spacing="2">
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Start" Justify="Justify.FlexStart" Style="padding:0">
                        <MudTooltip Text=@ProductDto?.Name>
                            <MudText Typo="Typo.h6" Class="fancy-title">
                                @(StringHelper.Truncate($"{ProductDto?.Name}", 33))
                            </MudText>
                        </MudTooltip>

                        <MudMenu Style="padding-left:0px!important">
                            <ActivatorContent>
                                <MudIcon Icon="@Icons.Material.Filled.KeyboardArrowDown"
                                     Class="mr-3 mb-n1"
                                     Color="Color.Primary" />
                            </ActivatorContent>
                            <ChildContent>
                                <MudMenuItem OnClick="@DialogEdit">Editar</MudMenuItem>
                            </ChildContent>
                        </MudMenu>
                    </MudStack>
                    @if (!string.IsNullOrEmpty(ProductDto.Description))
                    {
                        <MudText Typo="Typo.body2">
                            @StringHelper.GetShortOrFull(ProductDto.Description, showFullDescription,maxLengthDescription, out var compTruncated)
                            @if (ProductDto.Description?.Length > maxLengthDescription)
                            {
                                <MudLink @onclick="ToggleDescription" Typo="Typo.caption"
                                    Class="cursor-pointer" Style="color:#E91E63;">
                                    @(showFullDescription ? "Ver menos" : "Ver más")
                                </MudLink>
                            }
                        </MudText>
                    }
                    <MudText Typo="Typo.body2">
                        @((MarkupString)$"<strong>Ganancia recetas:</strong> {ProductDto?.ApplyProfitToRecipes}%, <strong>materiales:</strong> {ProductDto?.ApplyProfitToMaterials}%")
                    </MudText>
                    @if (!string.IsNullOrEmpty(componentsText))
                    {
                        <MudText Typo="Typo.body2">
                            @StringHelper.GetShortOrFull(componentsText, showFullComponents, maxLengthComponents, out var compTruncated)
                            @if (componentsText.Length > maxLengthComponents)
                            {
                                <MudLink @onclick="ToggleDescription" Typo="Typo.caption"
                                    Class="cursor-pointer" Style="color:#E91E63;">
                                    @(showFullComponents ? "Ver menos" : "Ver más")
                                </MudLink>
                            }
                        </MudText>
                    }
                </MudStack>

                <MudSpacer />

                <MudText Typo="Typo.h6" Style="margin-right:5%">$@ProductDto?.Total.ToString("N2")</MudText>
            </MudStack>
        </TitleContent>
        <DialogContent>
            <CascadingValue Value="ProductDto" IsFixed="false">
                <ProductComponents OnChanged="OnComponentsChanged" />
            </CascadingValue>
        </DialogContent>
    </MudDialog>
}
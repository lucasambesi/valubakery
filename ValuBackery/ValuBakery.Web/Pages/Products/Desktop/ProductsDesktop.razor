@using ValuBakery.Data.DTOs;
@inherits ValuBakery.Web.Pages.Products.ProductsBase

<MudTable Items="@ProductDtos" Dense="@false" Hover="@true" ReadOnly="@false" CanCancelEdit="@true"
          @bind-SelectedItem="selectedItem" Filter="new Func<ProductDto,bool>(FilterFunc)"
          SortLabel="Ordenar por" CommitEditTooltip="Confirmar" CancelEditTooltip="Cancelar"
          RowEditPreview="BackupItem" RowEditCancel="ResetItemToOriginalValues"
          RowEditCommit="ItemHasBeenCommitted" IsEditRowSwitchingBlocked="@false"
          Height="calc(100dvh - var(--mud-appbar-height, 64px) - 52px)" FixedHeader="true" FixedFooter="true"
          ApplyButtonPosition="@TableApplyButtonPosition.End" EditButtonPosition="@TableEditButtonPosition.End"
          EditTrigger="@TableEditTrigger.RowClick">
    <ColGroup>
        <col style="width:5%;" />
        <col style="width:40%;" />
        <col style="width:20%;" />
        <col style="width:35%;" />
    </ColGroup>
    <HeaderContent>
        <MudTh><MudIconButton Icon="@Icons.Material.Outlined.AddBox" Color="Color.Primary" Title="Crear" OnClick=@(() => DialogCreate(false)) /></MudTh>
        <MudTh>
            <MudIcon Icon="@Icons.Material.Filled.LocalDining" Class="me-1" Style="text-align:start" />
            <MudTableSortLabel T="ProductDto" InitialDirection="SortDirection.Ascending" SortBy="x => x.Name">Nombre</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudIcon Icon="@Icons.Material.Filled.Percent" Class="me-1" Style="text-align:start" />
            <MudTableSortLabel T="ProductDto" InitialDirection="SortDirection.Ascending" SortBy="x => x.ApplyProfitToRecipes">Ganancia</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudIcon Icon="@Icons.Material.Outlined.TextSnippet" Class="me-1" Style="text-align:start" />
            <MudTableSortLabel T="ProductDto" InitialDirection="SortDirection.Ascending" SortBy="x => x.Description">Descripción</MudTableSortLabel>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Acciones">
            <MudIconButton Title="Ver" Color="Color.Primary" Icon="@Icons.Material.Filled.Preview"
                            OnClick="() => ViewProduct(context.Id, false)" />
        </MudTd>
        <MudTd DataLabel="Nombre">
            <MudText Typo="Typo.body2" Class="font-weight-bold">@context.Name</MudText>
        </MudTd>
        <MudTd DataLabel="Ganancia">
            <MudText Typo="Typo.body2" Class="font-weight-bold">
                @($"R: {context.ApplyProfitToRecipes.ToString("N0")}% M: {context.ApplyProfitToMaterials.ToString("N0")}%")
            </MudText>
        </MudTd>
        <MudTd DataLabel="Description">
            <MudText Typo="Typo.body2" Class="text-truncate" Style="max-width: 250px;">@context.Description</MudText>
        </MudTd>
    </RowTemplate>
    <RowEditingTemplate>
        <MudTd DataLabel="Acciones"></MudTd>
        <MudTd DataLabel="Name">
            <MudTextField @bind-Value="context.Name" Required />
        </MudTd>
        <MudTd DataLabel="Ganancia">
            <MudTextField Value=@($"R: {context.ApplyProfitToRecipes.ToString("N0")}% M: {context.ApplyProfitToMaterials.ToString("N0")}%") ReadOnly Disabled="true" />
        </MudTd>
        <MudTd DataLabel="Descripción">
            <MudTextField @bind-Value="context.Description" />
        </MudTd>
    </RowEditingTemplate>
    <EditButtonContent Context="button">
        <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" Class="pa-0" OnClick="@button.ButtonAction" Disabled="@button.ButtonDisabled" />
    </EditButtonContent>

    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>
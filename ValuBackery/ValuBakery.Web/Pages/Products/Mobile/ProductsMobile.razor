@inherits ValuBakery.Web.Pages.Products.ProductsBase

@using MudBlazor
@using ValuBakery.Data.DTOs;
@using ValuBakery.Web.Pages.Common
@using ValuBakery.Web.Pages.Common.Skeletors.Mobile
@inject NavigationManager _navigationManager

<MudPaper Square="true" Elevation="0" Class="sticky-header px-3 pt-3 pb-1" Style="background-color:#FDF6ED; border-color:transparent">
    <MudTextField @bind-Value="search"
                  Placeholder="Buscar producto..."
                  Adornment="Adornment.Start"
                  AdornmentIcon="@Icons.Material.Filled.Search"
                  Variant="Variant.Outlined"
                  DisableUnderLine="true"
                  Clearable="true"
                  Disabled=@isLoading
                  Class="search-input"
                  Margin="Margin.Dense"
                  Style="width: 100%;" />
</MudPaper>

@if (isLoading)
{
    <ListMobileSkr />
}
else if (filteredProducts.Any())
{
    <MudContainer MaxWidth="MaxWidth.False" Class="px-2 pt-3 pb-6">
        @foreach (var item in filteredProducts)
        {
            <MudPaper Elevation="0"
              @onclick="@(() => ViewProduct(item.Id, true))"
              Class="ingredient-card slide-fade-in hover-elevate pa-3 d-flex align-center mb-2 clickable"
              Style="border-radius:20px; margin-bottom:0.8rem">
                <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" Class="w-100">

                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                        <MudAvatar Icon="@Icons.Material.Filled.FoodBank"
                           Color="@GetColor(string.Empty)"
                           Size="Size.Medium">
                            <MudImage Src="images/no_image.png" Alt="Sin imagen"></MudImage>
                        </MudAvatar>
                        <MudStack Spacing="0">
                            <MudText Typo="Typo.subtitle2" Class="fw-bold truncate-name">@item.Name</MudText>
                            @if (!string.IsNullOrEmpty(item.Description))
                            {
                                <MudText Typo="Typo.caption" Class="text-truncate" Style="max-width: 250px;" Color="Color.Default">
                                    @item.Description
                                </MudText>
                            }
                            else
                            {
                                <MudText Typo="Typo.caption" Class="text-truncate" Style="max-width: 350px;" Color="Color.Default">
                                    Sin descripción
                                </MudText>
                            }
                        </MudStack>
                    </MudStack>
                </MudStack>
            </MudPaper>
        }
    </MudContainer>

}
else
{
    <MudText Class="pa-4 text-center text-secondary">No se encontraron productos</MudText>
}

<MudFab Icon="@Icons.Material.Filled.Add"
        Color="Color.Secondary"
        Disabled=@isLoading
        Style="position: fixed; bottom: 16px; right: 16px; z-index: 20;"
        OnClick=@(() => DialogCreate(true)) />